<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>coreJS-app</title>
    <meta name="description" content="coreJS App Documentation" />
    <meta name="keywords" content="corejs-app" />
    <meta name="keyword" content="corejs-app" />
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    <meta property="og:site_name" content=""/>
    <meta property="og:url" content=""/>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"coreJS-app","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"coreJS-app","description":"coreJS App Documentation","keyword":"corejs-app"}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">coreJS-app</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="app">
            <span class="title">
                <a href="app.html">app</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.root"><a href="app.html#root">root</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.jst">
            <span class="title">
                <a href="app.jst.html">app.jst</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.oauth">
            <span class="title">
                <a href="app.oauth.html">app.oauth</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.oauth.URL_ENCODED"><a href="app.oauth.html#URL_ENCODED">URL_ENCODED</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.oauth.authorization"><a href="app.oauth.html#authorization">authorization</a></li>
            
                <li data-name="app.oauth.token"><a href="app.oauth.html#token">token</a></li>
            
                <li data-name="app.oauth.user"><a href="app.oauth.html#user">user</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.services">
            <span class="title">
                <a href="app.services.html">app.services</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.services.arrayScopesToString"><a href="app.services.html#arrayScopesToString">arrayScopesToString</a></li>
            
                <li data-name="app.services.isCrossDomain"><a href="app.services.html#isCrossDomain">isCrossDomain</a></li>
            
                <li data-name="app.services.request"><a href="app.services.html#request">request</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.services.method">
            <span class="title">
                <a href="app.services.method.html">app.services.method</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.services.method.DELETE"><a href="app.services.method.html#DELETE">DELETE</a></li>
            
                <li data-name="app.services.method.GET"><a href="app.services.method.html#GET">GET</a></li>
            
                <li data-name="app.services.method.HEAD"><a href="app.services.method.html#HEAD">HEAD</a></li>
            
                <li data-name="app.services.method.OPTIONS"><a href="app.services.method.html#OPTIONS">OPTIONS</a></li>
            
                <li data-name="app.services.method.PATCH"><a href="app.services.method.html#PATCH">PATCH</a></li>
            
                <li data-name="app.services.method.POST"><a href="app.services.method.html#POST">POST</a></li>
            
                <li data-name="app.services.method.PUT"><a href="app.services.method.html#PUT">PUT</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.session">
            <span class="title">
                <a href="app.session.html">app.session</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.session.STATUS_SELECTOR"><a href="app.session.html#STATUS_SELECTOR">STATUS_SELECTOR</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.session.add"><a href="app.session.html#add">add</a></li>
            
                <li data-name="app.session.destroy"><a href="app.session.html#destroy">destroy</a></li>
            
                <li data-name="app.session.exist"><a href="app.session.html#exist">exist</a></li>
            
                <li data-name="app.session.gatekeeper"><a href="app.session.html#gatekeeper">gatekeeper</a></li>
            
                <li data-name="app.session.get"><a href="app.session.html#get">get</a></li>
            
                <li data-name="app.session.isPersistent"><a href="app.session.html#isPersistent">isPersistent</a></li>
            
                <li data-name="app.session.logged"><a href="app.session.html#logged">logged</a></li>
            
                <li data-name="app.session.removeStatus"><a href="app.session.html#removeStatus">removeStatus</a></li>
            
                <li data-name="app.session.setPersistent"><a href="app.session.html#setPersistent">setPersistent</a></li>
            
                <li data-name="app.session.setStatus"><a href="app.session.html#setStatus">setStatus</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.user">
            <span class="title">
                <a href="app.user.html">app.user</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.user.login"><a href="app.user.html#login">login</a></li>
            
                <li data-name="app.user.loginToken"><a href="app.user.html#loginToken">loginToken</a></li>
            
                <li data-name="app.user.logout"><a href="app.user.html#logout">logout</a></li>
            
                <li data-name="app.user.register"><a href="app.user.html#register">register</a></li>
            
                <li data-name="app.user.registerIAM"><a href="app.user.html#registerIAM">registerIAM</a></li>
            
                <li data-name="app.user.remove"><a href="app.user.html#remove">remove</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.user.statusCode">
            <span class="title">
                <a href="app.user.statusCode.html">app.user.statusCode</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.user.statusCode.USER_EXIST"><a href="app.user.statusCode.html#USER_EXIST">USER_EXIST</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="session.js.html">Source: engine/session.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source"><code>'use strict';
/* globals define */
define([
    'corejs/app',
    'underscore',
    'corejs/engine/validate'
], function(app, _, validate) {

    /** 
     * A module to manage session data.
     * @exports session
     * @namespace
     * @memberof app
     */
    var session = {

        /**
         * STATUS_SELECTOR constant
         * @type {String}
         * @default body
         */
        STATUS_SELECTOR: 'body'
    };

    /**
     * Sets an application status to STATUS_SELECTOR
     * @param {String} status Name of the status
     * @param {Boolean} active true if active, false id disabled
     */
    session.setStatus = function(status, active) {
        if (active) {
            $(this.STATUS_SELECTOR).removeClass('not-' + status).addClass(status);
        } else {
            $(this.STATUS_SELECTOR).removeClass(status).addClass('not-' + status);
        }
        return this;
    };

    /**
     * Removes a specific status from STATUS_SELECTOR
     * @param  {String} status
     */
    session.removeStatus = function(status) {
        $(this.STATUS_SELECTOR).removeClass(status).removeClass('not-' + status);
    };

    /**
     * Checks active sessions and updates the app status
     * @return {Boolean}
     */
    session.gatekeeper = function() {
        var exist = this.exist();

        if (exist) {
            this.setStatus('logged', true);
        } else {
            this.setStatus('logged', false);
        }

        return exist;
    };

    /**
     * Checks when a session exists
     * @return {Boolean}
     */
    session.exist = function() {
        // TODO: Do it better, diff between anonymous and real user
        // Setted at user.login()
        app.log.debug('session.exist.user', this.get('loggedTime'));
        return this.get('loggedTime') ? true : false;
    };

    /**
     * Creates a user session data
     * @param  {Object} args
     * @param  {Boolean} args.persistent
     * @param  {String} args.accessToken
     * @param  {String} args.oauthService
     * @param  {Object} args.user
     */
    session.logged = function(args) {
        validate.isValue(args.accessToken, 'Missing accessToken');
        validate.isValue(args.oauthService, 'Missing oauthService');
        validate.isValue(args.user, 'Missing user');

        this.setPersistent(args.persistent);

        this.add('accessToken', args.accessToken);
        this.add('oauthService', args.oauthService);
        this.add('loggedTime', new Date().getTime());
        this.add('user', args.user);

        this.setStatus('logged', true);
    };

    /**
     * Gets a specific session value
     * @param  {String} key
     * @return {String|Number|Boolean}
     */
    session.get = function(key) {

        key = key || 'session';

        app.log.debug('session.get.local', localStorage);
        app.log.debug('session.get.session', sessionStorage);
        app.log.debug('session.get.' + key, sessionStorage.getItem(key));

        var storage = localStorage;
        if (this.isPersistent()) {
            app.log.debug('session.get.sessionStorage:' + key);

        } else if (sessionStorage.getItem(key)) {
            app.log.debug('session.get.sessionStorage:' + key);
            storage = sessionStorage;
        } else {

            app.log.debug('session.get.none');
            return false;
        }

        try {
            return JSON.parse(sessionStorage.getItem(key));
        } catch (e) {
            return sessionStorage.getItem(key);
        }
    };

    /**
     * Adds a key-value in the user session
     * @param {String} key
     * @param {String|Number|Boolean} value
     */
    session.add = function(key, value) {
        var storage = sessionStorage;

        if (this.isPersistent()) {
            storage = localStorage;
        }

        app.log.debug('session.add.' + key);
        app.log.debug(value);

        if (_.isObject(value)) {
            value = JSON.stringify(value);
        }
        storage.setItem(key, value);
    };

    /**
     * Checks if the current session is persistent or not
     * @return {Boolean}
     */
    session.isPersistent = function() {
        return (localStorage.persistent ? true : false);
    };

    /**
     * Creates a user session with 
     * @param {Boolean} persistent
     */
    session.setPersistent = function(persistent) {
        if (persistent) {
            localStorage.setItem('persistent', persistent);
        } else {
            localStorage.removeItem('persistent');
        }
    };

    /**
     * Clears all user storage
     */
    session.destroy = function() {
        localStorage.clear();
        sessionStorage.clear();
        this.setStatus('logged', false);
    };

    // Exposes module
    app.session = session;

    return session;
});</code></pre>
        </article>
    </section>





        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Apr 04 2014 18:45:54 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>